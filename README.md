# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types - типы данные и интерфейсы

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Используемый стек

В проекте используются следующие технологии:

- **HTML** — для разметки страниц.
- **SCSS** — для написания стилей с использованием вложенности и переменных.
- **TypeScript** — для типизации и написания логики приложения.
- **Webpack** — для сборки проекта, обработки стилей, скриптов и ресурсов.
- **Node.js + npm** — для управления зависимостями и запуска скриптов.

## Описание архитектуры

### Архитектурный подход

Проект реализован по принципам MVP (Model-View-Presenter) с использованием событийной шины (EventEmitter):

- **Model** отвечает за хранение и обработку данных, бизнес-логику и валидацию.
- **View** отображает данные и инициирует пользовательские действия через события.
- **Presenter** как отдельный слой отсутствует — его роль выполняет центральный обработчик событий (index.ts), который связывает Model и View через события.
- Взаимодействие между слоями построено на слабой связанности: все компоненты общаются только через события.

Файл [`src/index.ts`](src/index.ts), связывает Model и View через обработчики событий и управляет бизнес-логикой приложения.

Взаимодействие между слоями осуществляется через событийную систему (EventEmitter).

### 1. API

Вся работа с сервером инкапсулирована в классе `LarekApi`, который расширяет базовый класс `Api`.
API реализует следующие методы:

- **getProducts()** — получение списка товаров (`GET /product`).  
  Возвращает массив товаров с подставленными ссылками на изображения.
- **makeOrder(order: IMakeOrder)** — создание заказа (`POST /order`).  
  Принимает объект заказа, возвращает информацию о созданном заказе.

Базовый класс `Api` реализует универсальные методы для HTTP-запросов (`get`, `post`, `handleResponse`), а также обработку ошибок.

Типы данных для API:

- `IProduct` — товар
- `IMakeOrder` — данные для создания заказа
- `ICreatedOrder` — результат создания заказа

#### Описание полей:

**IProduct**

- `id: string` — идентификатор товара
- `description: string` — описание товара
- `image: string` — ссылка на изображение товара
- `title: string` — название товара
- `category: string` — категория товара
- `price: number | null` — цена товара (может быть null)

**IMakeOrder**

- `payment: IPaymentType | null` — выбранный способ оплаты (`'card'` или `'cash'`, либо null)
- `email: string` — email покупателя
- `address: string` — адрес доставки
- `phone: string` — телефон покупателя
- `total: number` — итоговая сумма заказа
- `items: string[]` — массив идентификаторов товаров в заказе

**ICreatedOrder**

- `id: string` — идентификатор созданного заказа
- `total: number` — итоговая сумма заказа

### Модели

Модель — это сущность, используемая в логике приложения, которая содержит необходимые данные для работы фронтенда. На данный момент модели почти полностью совпадают с ответами API, но могут содержать дополнительные поля, нужные для клиентской логики.

#### IProductModel

Наследует все поля из `IProduct` (см. выше), а также добавляет:

- `isInBasket: boolean` — находится ли товар в корзине

**Поля IProductModel:**

- `id: string` — идентификатор товара
- `description: string` — описание товара
- `image: string` — ссылка на изображение товара
- `title: string` — название товара
- `category: string` — категория товара
- `price: number | null` — цена товара (может быть null)
- `isInBasket: boolean` — находится ли товар в корзине

#### IAppState

- `basket: IProduct[]` — массив товаров, находящихся в корзине
- `products: IProductModel[]` — массив товаров каталога с признаком наличия в корзине
- `orderForm: IOrderForm` — данные формы заказа (контакты, адрес, способ оплаты и ошибки валидации)
- `setEmail(email: string): void` — устанавливает значение email в форме заказа.
- `setPhone(phone: string): void` — устанавливает номер телефона в форме заказа.
- `setAddress(address: string): void` — устанавливает адрес доставки в форме заказа.
- `setPayment(payment: IPaymentType): void` — устанавливает выбранный способ оплаты (`'card'` или `'cash'`).
- `toggleProductInBasket(id: string): void` — добавляет или удаляет товар с указанным идентификатором из корзины.
- `resetOrderForm(): void` — сбрасывает все поля формы заказа к значениям по умолчанию.
- `clearBasket(): void` — очищает корзину (удаляет все товары).
- `selectedProduct: IProductModel | null` — выбранный товар, `null` если ничего не выбрано.

**Поля IAppState:**

- `basket: IProduct[]` — товары в корзине
- `products: IProductModel[]` — товары каталога с флагом наличия в корзине
- `orderForm: IOrderForm` — состояние формы заказа

### 2. Screens

**Screens** — это контейнеры для отображения различных этапов пользовательского сценария. Каждый экран наследуется от базового класса `Screen` и содержит ссылки на соответствующие View-компоненты.

Список экранов:

- **AppScreen** — основной экран каталога товаров, содержит галерею и карточку деталей товара.
- **BasketScreen** — экран корзины, содержит кнопку корзины и модальное окно с товарами.
- **PaymentScreen** — экран выбора способа оплаты и ввода адреса.
- **ContactScreen** — экран ввода контактных данных.
- **OrderSuccessScreen** — экран успешного оформления заказа.

Каждый экран реализует методы:

- `init()` — инициализация и создание View-компонентов.
- `update(state)` — обновление состояния экрана на основе модели.

### 3. Views

**Views** — компоненты для отображения и управления отдельными частями интерфейса. Все View наследуются от базового класса `View`, который реализует методы для рендера, поиска и инициализации элементов.

#### Базовые поля всех View:

- `settings: object` — настройки компонента (обычно содержит EventEmitter и другие параметры).
- Методы: `init()`, `render()`, `copy()`, `querySelector()`, `ensureElement()` и др.

#### GalleryView

- Нет собственных геттеров/сеттеров для полей состояния.

#### ProductCardView

- `id: string` — идентификатор товара (data-атрибут).
- `title: string` — название товара.
- `price: number | null` — цена товара.
- `image: string` — ссылка на изображение.
- `category: string` — категория товара.
- `description: string` — описание товара.
- `isInBasket: boolean` — находится ли товар в корзине.

#### BasketModalView

- `isDisabled: boolean` — заблокирована ли кнопка оформления заказа.

#### OrderPaymentModalView

- `payment: string` — выбранный способ оплаты.
- `address: string` — введённый адрес.

#### OrderContactsModalView

- `email: string` — введённый email.
- `phone: string` — введённый телефон.

#### OrderSuccessView

- Нет геттеров/сеттеров для состояния (только метод render).

#### ModalView

- `content: HTMLElement | undefined` — содержимое модального окна.

Каждый View принимает настройки (settings), в том числе ссылку на EventEmitter для генерации событий.

### 4. События

Взаимодействие между слоями и компонентами реализовано через событийную систему (`EventEmitter`).  
Список основных событий:

#### Корзина:

- `basket:open` — открыть корзину (открывает модальное окно с содержимым корзины)
- `basket:change` — добавить или удалить товар из корзины (`{ id }`). Используется для переключения состояния товара в корзине (добавление/удаление)

#### Товары:

- `product:show-details` — открыть детали товара (`{ id }`). Открывает модальное окно с подробной информацией о товаре

#### Оформление заказа:

- `order:payment` — открыть экран оплаты (открывает форму выбора способа оплаты и адреса)
- `order:contacts` — открыть экран ввода контактов (открывает форму для ввода email и телефона, вызывается после выбора оплаты и адреса, а также для передачи данных из формы оплаты)
- `order:success` — открыть экран успешного заказа (открывает модальное окно с итоговой суммой)
- `order:success-close` — закрыть экран успешного заказа (закрывает модальное окно успешного заказа)
- `order:submit` — отправить заказ (вызывается при отправке формы контактов)

#### Формы заказа:

- `order:payment-change` — изменение способа оплаты (`{ payment }`). Вызывается при выборе способа оплаты
- `order:address-change` — изменение адреса (`{ address }`). Вызывается при вводе адреса
- `order:email-change` — изменение email (`{ email }`). Вызывается при вводе email
- `order:phone-change` — изменение телефона (`{ phone }`). Вызывается при вводе телефона

#### Внутренние события модели (для обновления UI):

- `model:products-change` — изменился список товаров
- `model:selected-product-change` — изменился выбранный товар
- `model:order-form-change` — изменились данные формы заказа (оплата, адрес, email, телефон, ошибки)
- `model:basket-change` — изменилось содержимое корзины

Каждое событие инициируется из View-компонентов и обрабатывается в главном файле приложения (`src/index.ts`), где происходит обновление состояния, переключение экранов и вызовы API.

### EventEmitter

В качестве механизма коммуникации между слоями и компонентами используется событийная система — класс `EventEmitter`. Он реализует паттерн pub/sub (издатель/подписчик):

- **View-компоненты** инициируют события (например, нажатие кнопки, изменение формы) через EventEmitter.
- **Главный файл приложения** (`src/index.ts`) подписывается на эти события и реализует обработчики, которые обновляют Model и View, а также вызывают методы API.
